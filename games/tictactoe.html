<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Tic Tac Toe</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- THREE.JS -->
<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>

<style>
body{
  margin:0;
  background:#05070c;
  font-family:Arial;
  color:#fff;
  text-align:center;
}
.top{
  padding:10px;
}
button,select{
  padding:6px 12px;
  border:none;
  border-radius:6px;
  font-weight:bold;
}
canvas{
  display:block;
  margin:auto;
}
.score{
  margin:8px 0;
}
</style>
</head>

<body>

<div class="top">
  <button onclick="setMode('ai')">VS AI</button>
  <button onclick="setMode('two')">Two Players</button>

  <select onchange="setTheme(this.value)">
    <option value="neon">Neon</option>
    <option value="dark">Dark</option>
    <option value="classic">Classic</option>
  </select>

  <div class="score">
    X: <span id="sx">0</span> |
    O: <span id="so">0</span>
  </div>

  <div id="status">Choose mode</div>
</div>

<script>
/* ---------- SOUND ---------- */
const sndClick=new Audio("https://cdn.pixabay.com/audio/2022/03/15/audio_74f9cbb1f4.mp3");
const sndWin=new Audio("https://cdn.pixabay.com/audio/2022/03/15/audio_61b2a08a68.mp3");

/* ---------- GAME STATE ---------- */
let board=Array(9).fill("");
let current="X";
let mode="";
let scores={X:0,O:0};
let gameOn=false;

/* ---------- THREE.JS ---------- */
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,0.1,1000);
const renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight-150);
document.body.appendChild(renderer.domElement);

camera.position.set(0,6,8);
camera.lookAt(0,0,0);

const light=new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,10,5);
scene.add(light);

/* ---------- BOARD ---------- */
const tiles=[];
const geo=new THREE.BoxGeometry(1.8,0.4,1.8);

for(let i=0;i<9;i++){
  let mat=new THREE.MeshStandardMaterial({color:0x222244});
  let tile=new THREE.Mesh(geo,mat);
  tile.position.set((i%3-1)*2,0,(-Math.floor(i/3)+1)*2);
  tile.userData.index=i;
  scene.add(tile);
  tiles.push(tile);
}

/* ---------- WIN LINE ---------- */
let winLine;
function drawWinLine(a,b){
  const g=new THREE.BufferGeometry().setFromPoints([tiles[a].position,tiles[b].position]);
  const m=new THREE.LineBasicMaterial({color:0xffff00});
  winLine=new THREE.Line(g,m);
  scene.add(winLine);
}

/* ---------- THEME ---------- */
function setTheme(t){
  const colors={
    neon:0x00ffd5,
    dark:0x333333,
    classic:0xffffff
  };
  tiles.forEach(tl=>tl.material.color.setHex(colors[t]));
}

/* ---------- MODE ---------- */
function setMode(m){
  mode=m;
  reset();
  gameOn=true;
  document.getElementById("status").innerText=current+"'s turn";
}

/* ---------- AI (MINIMAX) ---------- */
function aiMove(){
  let best=-Infinity,move;
  for(let i=0;i<9;i++){
    if(!board[i]){
      board[i]="O";
      let score=minimax(board,0,false);
      board[i]="";
      if(score>best){best=score;move=i;}
    }
  }
  play(move);
}

function minimax(b,depth,isMax){
  if(check("O")) return 10-depth;
  if(check("X")) return depth-10;
  if(b.every(c=>c)) return 0;

  let best=isMax?-Infinity:Infinity;
  for(let i=0;i<9;i++){
    if(!b[i]){
      b[i]=isMax?"O":"X";
      let s=minimax(b,depth+1,!isMax);
      b[i]="";
      best=isMax?Math.max(best,s):Math.min(best,s);
    }
  }
  return best;
}

/* ---------- CLICK ---------- */
const raycaster=new THREE.Raycaster();
const mouse=new THREE.Vector2();

window.addEventListener("click",e=>{
  if(!gameOn)return;
  mouse.x=(e.clientX/window.innerWidth)*2-1;
  mouse.y=-(e.clientY/window.innerHeight)*2+1;
  raycaster.setFromCamera(mouse,camera);
  const hit=raycaster.intersectObjects(tiles);
  if(hit.length) play(hit[0].object.userData.index);
});

/* ---------- PLAY ---------- */
function play(i){
  if(board[i])return;
  sndClick.play();
  board[i]=current;
  tiles[i].material.color.setHex(current==="X"?0x00ffd5:0xff5c8a);

  if(check(current)){
    sndWin.play();
    scores[current]++;
    document.getElementById("sx").innerText=scores.X;
    document.getElementById("so").innerText=scores.O;
    document.getElementById("status").innerText=current+" wins!";
    gameOn=false;
    return;
  }

  if(board.every(c=>c)){
    document.getElementById("status").innerText="Draw!";
    gameOn=false;
    return;
  }

  current=current==="X"?"O":"X";
  document.getElementById("status").innerText=current+"'s turn";

  if(mode==="ai" && current==="O") setTimeout(aiMove,400);
}

/* ---------- CHECK ---------- */
const wins=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
function check(p){
  for(let w of wins){
    if(w.every(i=>board[i]===p)){
      drawWinLine(w[0],w[2]);
      return true;
    }
  }
  return false;
}

/* ---------- RESET ---------- */
function reset(){
  board.fill("");
  current="X";
  tiles.forEach(t=>t.material.color.setHex(0x222244));
  if(winLine) scene.remove(winLine);
}

/* ---------- RENDER ---------- */
function animate(){
  requestAnimationFrame(animate);
  scene.rotation.y+=0.002;
  renderer.render(scene,camera);
}
animate();
</script>

</body>
</html>
