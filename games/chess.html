<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Chess vs AI</title>
<style>
  body{
    margin:0;
    background:#050814;
    color:#fff;
    font-family:Arial, sans-serif;
    display:flex;
    flex-direction:column;
    align-items:center;
  }
  h1{margin:20px 0}

  .mode button{
    margin:5px;
    padding:8px 14px;
    background:#00e5ff;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-weight:bold;
  }

  .board{
    display:grid;
    grid-template-columns:repeat(8,60px);
    grid-template-rows:repeat(8,60px);
    border:3px solid #00e5ff;
    margin-top:20px;
  }

  .cell{
    width:60px;
    height:60px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:36px;
    cursor:pointer;
    user-select:none;
  }

  .white{background:#eee;color:#000}
  .black{background:#555}
  .hint{background:#00e5ff!important}

  .controls{
    margin:15px;
  }
  .controls button{
    padding:8px 14px;
    margin:5px;
    background:#00e5ff;
    border:none;
    border-radius:6px;
    cursor:pointer;
  }
</style>
</head>

<body>

<h1>Chess vs AI</h1>

<div class="mode">
  <button onclick="setMode('manual')">2 Player</button>
  <button onclick="setMode('ai')">Vs AI</button>
</div>

<div id="status">White's move</div>

<div class="board" id="board"></div>

<div class="controls">
  <button onclick="resetGame()">Restart</button>
  <button onclick="location.href='../index.html'">Back</button>
</div>

<script>
let mode="manual";
let turn="white";
let selected=-1;
let hints=[];

const pieces={
  r:"♜",n:"♞",b:"♝",q:"♛",k:"♚",p:"♟",
  R:"♖",N:"♘",B:"♗",Q:"♕",K:"♔",P:"♙"
};

let board=[
"r","n","b","q","k","b","n","r",
"p","p","p","p","p","p","p","p",
"","","","","","","","",
"","","","","","","","",
"","","","","","","","",
"","","","","","","","",
"P","P","P","P","P","P","P","P",
"R","N","B","Q","K","B","N","R"
];

const boardDiv=document.getElementById("board");

function setMode(m){
  mode=m;
  resetGame();
}

function resetGame(){
  board=[
  "r","n","b","q","k","b","n","r",
  "p","p","p","p","p","p","p","p",
  "","","","","","","","",
  "","","","","","","","",
  "","","","","","","","",
  "","","","","","","","",
  "P","P","P","P","P","P","P","P",
  "R","N","B","Q","K","B","N","R"
  ];
  turn="white";
  selected=-1;
  hints=[];
  render();
  updateStatus();
}

function updateStatus(){
  document.getElementById("status").innerText=
    mode==="ai"
    ? (turn==="white"?"Your move":"AI thinking...")
    : (turn==="white"?"White's move":"Black's move");
}

function render(){
  boardDiv.innerHTML="";
  for(let i=0;i<64;i++){
    const c=document.createElement("div");
    c.className="cell "+(((Math.floor(i/8)+i)%2)?"black":"white");
    if(hints.includes(i)) c.classList.add("hint");
    c.innerHTML=pieces[board[i]]||"";
    c.onclick=()=>clickSquare(i);
    boardDiv.appendChild(c);
  }
}

function clickSquare(i){
  let piece=board[i];

  if(selected===-1){
    if(turn==="white" && "PNBRQK".includes(piece)){
      selected=i; hints=getMoves(i);
    }
    if(turn==="black" && "pnbrqk".includes(piece)){
      selected=i; hints=getMoves(i);
    }
    render(); return;
  }

  if(hints.includes(i)){
    board[i]=board[selected];
    board[selected]="";
    selected=-1; hints=[];
    turn=turn==="white"?"black":"white";
    render(); updateStatus();

    if(mode==="ai" && turn==="black"){
      setTimeout(aiMove,400);
    }
  }else{
    selected=-1; hints=[]; render();
  }
}

function aiMove(){
  let moves=[];
  for(let i=0;i<64;i++){
    if("pnbrqk".includes(board[i])){
      getMoves(i).forEach(m=>moves.push({f:i,t:m}));
    }
  }
  if(!moves.length) return;
  let m=moves[Math.floor(Math.random()*moves.length)];
  board[m.t]=board[m.f];
  board[m.f]="";
  turn="white";
  render(); updateStatus();
}

function getMoves(i){
  let p=board[i];
  let r=Math.floor(i/8), c=i%8;
  let res=[];
  const dir=p==="P"?-1:p==="p"?1:0;

  if(p==="P"||p==="p"){
    let n=i+dir*8;
    if(board[n]==="") res.push(n);
  }

  const knight=[[2,1],[2,-1],[-2,1],[-2,-1],[1,2],[1,-2],[-1,2],[-1,-2]];
  if("Nn".includes(p)){
    knight.forEach(d=>{
      let nr=r+d[0], nc=c+d[1];
      if(nr>=0&&nr<8&&nc>=0&&nc<8){
        let t=nr*8+nc;
        if(board[t]===""||isEnemy(p,board[t])) res.push(t);
      }
    });
  }

  const lines={
    B:[[1,1],[1,-1],[-1,1],[-1,-1]],
    R:[[1,0],[-1,0],[0,1],[0,-1]],
    Q:[[1,1],[1,-1],[-1,1],[-1,-1],[1,0],[-1,0],[0,1],[0,-1]]
  };

  if("BRQbrq".includes(p)){
    let key=p.toUpperCase();
    lines[key].forEach(d=>{
      let nr=r+d[0], nc=c+d[1];
      while(nr>=0&&nr<8&&nc>=0&&nc<8){
        let t=nr*8+nc;
        if(board[t]==="") res.push(t);
        else{
          if(isEnemy(p,board[t])) res.push(t);
          break;
        }
        nr+=d[0]; nc+=d[1];
      }
    });
  }

  if("Kk".includes(p)){
    for(let dr=-1;dr<=1;dr++)
      for(let dc=-1;dc<=1;dc++){
        if(dr||dc){
          let nr=r+dr,nc=c+dc;
          if(nr>=0&&nr<8&&nc>=0&&nc<8){
            let t=nr*8+nc;
            if(board[t]===""||isEnemy(p,board[t])) res.push(t);
          }
        }
      }
  }

  return res;
}

function isEnemy(a,b){
  return (a===a.toUpperCase()) !== (b===b.toUpperCase());
}

resetGame();
</script>

</body>
</html>
